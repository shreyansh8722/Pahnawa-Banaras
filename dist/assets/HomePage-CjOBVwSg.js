const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./LoginPromptModal-CLmRM6Jh.js","./index-B8VDtRNT.js","./index-CN0tYJS4.css","./index-DvID8duW.js","./proxy-D6jU1156.js","./x-CknCDQHz.js","./mail-Brpwsg6K.js","./user-tGXpPrQG.js"])))=>i.map(i=>d[i]);
import{c as ae,r as a,j as e,L as ce,R as de,_ as Y,d as X,e as te,k as me,f as K,a as ue,b as xe,g as he}from"./index-B8VDtRNT.js";import{m as d}from"./proxy-D6jU1156.js";import{S as pe}from"./star-DzlMAkee.js";import{C as ie}from"./chevron-right-CoNWUuoB.js";import{M as fe}from"./map-pin-BBLdVa1x.js";import{S as be}from"./search-BkiIOp6w.js";import{A as G}from"./index-DvID8duW.js";import{X as se}from"./x-CknCDQHz.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],we=ae("arrow-up-right",ge);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],je=ae("sliders-horizontal",ye),ve=[{id:"All",label:"All"},{id:"Popular",label:"Popular"},{id:"Budget",label:"Budget Friendly"},{id:"Recommended",label:"Recommended"}];function Ne(s,i){return!i||i==="All"?s:i==="Popular"?s.filter(r=>(r.averageRating??0)>=4.5):i==="Budget"?s.filter(r=>{var o;const l=(o=r.priceRange)==null?void 0:o.match(/\d+/g);return l&&Number(l[0])<=350}):i==="Recommended"?s.filter(r=>(r.reviewCount??0)>10):s}const Se=(s,i="100px")=>{const[r,l]=a.useState(!1);return a.useEffect(()=>{let o=s.current;if(!o)return;const u=new IntersectionObserver(([n])=>{n.isIntersecting&&(l(!0),o&&u.unobserve(o))},{rootMargin:i});return u.observe(o),()=>{o&&u.unobserve(o)}},[s,i]),r},oe=()=>e.jsx("div",{className:"w-[160px] h-[220px] bg-gray-800/40 rounded-3xl animate-pulse flex-shrink-0 mx-1"}),ke=({src:s,alt:i,className:r,isPriority:l=!1})=>{const[o,u]=a.useState(!1);return e.jsxs("div",{className:"relative w-full h-full",children:[!o&&e.jsx("div",{className:"absolute inset-0 bg-gray-800/30 animate-pulse rounded-2xl"}),e.jsx("img",{src:s,alt:i,loading:l?"eager":"lazy",fetchpriority:l?"high":"auto",onLoad:()=>u(!0),className:`${r} transition-opacity duration-500 ${o?"opacity-100":"opacity-0"}`})]})},Ce=a.memo(({spot:s,idx:i,activeIdx:r,navigate:l,isPriority:o=!1})=>{var v;const u=s.featuredImageUrl||((v=s.imageUrls)==null?void 0:v[0])||"https://placehold.co/600x400",n=i===r;return e.jsxs(d.div,{"data-idx":i,layout:!0,whileTap:{scale:.97},animate:{scale:n?1.05:1},transition:{type:"spring",stiffness:260,damping:25},className:"relative flex-shrink-0 rounded-3xl overflow-hidden shadow-lg w-[160px] h-[220px] cursor-pointer mx-1 snap-start bg-white/5 border border-white/6",onClick:()=>l(`/spot/${encodeURIComponent(s.id)}`),children:[e.jsx(ke,{src:u,alt:s.name,className:"w-full h-full object-cover rounded-3xl",isPriority:o}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent rounded-3xl"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/10 to-transparent rounded-3xl"}),e.jsx("div",{className:"absolute top-3 right-3 p-2 rounded-full bg-black/30 backdrop-blur-sm",children:e.jsx(we,{size:16,className:"text-white"})}),e.jsxs("div",{className:"absolute bottom-3 left-3 right-3",children:[s.averageRating&&e.jsxs("div",{className:"flex items-center gap-1 text-white/90 text-sm mb-1 backdrop-blur-sm bg-black/20 px-1.5 py-0.5 rounded-full w-fit",children:[e.jsx(pe,{size:12,className:"fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"font-semibold",children:s.averageRating}),e.jsxs("span",{className:"text-white/70",children:["(",s.reviewCount||0,")"]})]}),e.jsx("h3",{className:"text-white text-base font-bold line-clamp-2 leading-tight drop-shadow-xl",children:s.name})]})]})}),Ie=()=>{const[s,i]=a.useState(!1);return a.useEffect(()=>{const r=window.innerWidth<768,l=sessionStorage.getItem("swipeHintShown");r&&!l&&(i(!0),sessionStorage.setItem("swipeHintShown","true"),setTimeout(()=>i(!1),3e3))},[]),s?e.jsxs(d.div,{initial:{opacity:0,x:15},animate:{opacity:[0,1,0],x:[15,0,-10]},transition:{duration:2.2,ease:"easeInOut"},className:"absolute top-[45%] right-3 flex items-center gap-1 text-gray-300/70 text-xs font-medium select-none pointer-events-none",children:[e.jsx("span",{children:"Swipe"}),e.jsx(ie,{size:13})]}):null},Re=a.memo(({category:s,selectedCity:i,globalFilter:r,isPriorityRow:l=!1,navigate:o,user:u,showToast:n,showLoginPrompt:v})=>{const[C,I]=a.useState([]),[W,R]=a.useState(!0),L=a.useRef(null),f=Se(L),[N,H]=a.useState(!1),[F,T]=a.useState(0),O=a.useRef(null),U=a.useCallback(()=>{const c=O.current;if(!c)return;const b=Array.from(c.querySelectorAll("[data-idx]"));if(!b.length)return;const g=c.getBoundingClientRect(),z=g.left+g.width/2;let S=0,w=1/0;b.forEach(M=>{const A=M.getBoundingClientRect(),D=A.left+A.width/2,V=Math.abs(D-z),E=Number(M.getAttribute("data-idx"));V<w&&(w=V,S=E)}),T(S)},[]);a.useEffect(()=>{if(!f||!s.id||!i||N)return;let c=!0;return(async()=>{R(!0);try{const g=de(Y(X,"spots"),te("category","==",s.id),te("cityId","==",i),me(10)),z=await K(g);if(!c)return;const S=z.docs.map(w=>({id:w.id,...w.data()}));I(S),H(!0)}catch(g){console.error(`Failed to fetch spots for: ${s.id} in ${i}`,g)}finally{c&&R(!1)}})(),()=>c=!1},[f,s.id,i,N]),a.useEffect(()=>{H(!1),I([]),R(!0)},[i,s.id]);let x=s.name||s.id;s.id.toLowerCase().includes("food")||s.name&&s.name.toLowerCase().includes("food")?x=`Local eateries in ${i}`:s.id.toLowerCase().includes("heritage")||s.name&&s.name.toLowerCase().includes("heritage")?x=`Top spots in ${i}`:(s.id.toLowerCase().includes("artifact")||s.name&&s.name.toLowerCase().includes("artifact"))&&(x=`Local crafts in ${i}`);const P=Ne(C,r);return!f&&!N?e.jsx("div",{ref:L,className:"h-[240px] w-full"}):!W&&P.length===0?null:e.jsxs("section",{ref:L,className:"mb-8 relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold capitalize",children:x}),e.jsx(ce,{to:`/category/${s.id}`,className:"text-xs font-medium text-gray-300 bg-white/6 px-3 py-1.5 rounded-full hover:bg-white/8 transition-colors","aria-label":`See all ${x}`,children:"See All"})]}),e.jsx("div",{ref:O,onScroll:U,className:"flex gap-4 overflow-x-auto no-scrollbar py-2 px-[6px] scroll-smooth snap-x snap-mandatory",children:W?[1,2,3,4].map(c=>e.jsx(oe,{},c)):P.map((c,b)=>e.jsx(Ce,{spot:c,idx:b,activeIdx:F,isPriority:l&&b===0,navigate:o},c.id))}),P.length>2&&e.jsx(Ie,{})]})}),Le=a.lazy(()=>he(()=>import("./LoginPromptModal-CLmRM6Jh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url));function Fe(){var Q;const s=ue(),{user:i}=xe(),[r,l]=a.useState([]),[o,u]=a.useState([]),[n,v]=a.useState(()=>sessionStorage.getItem("selectedCity")||""),[C,I]=a.useState(!0),[W,R]=a.useState(!1),[L,f]=a.useState(!1),[N,H]=a.useState("All"),[F,T]=a.useState(""),[O,U]=a.useState(!1),[x,P]=a.useState(""),[c,b]=a.useState(""),[g,z]=a.useState(""),[S,w]=a.useState(!1),[M,A]=a.useState(!1),D=a.useRef(null),[V,E]=a.useState(!1),Z=a.useCallback(t=>{T(t),setTimeout(()=>T(""),2e3)},[]),ne=a.useCallback(()=>U(!0),[]),re=(((Q=i==null?void 0:i.displayName)==null?void 0:Q.split(" ")[0])||"Guest").replace(/[^A-Za-z]/g,"")||"Guest",J=a.useCallback(async()=>{I(!0);try{const[t,m]=await Promise.all([K(Y(X,"cities")),K(Y(X,"categories"))]),h=t.docs.map(p=>({id:p.id,...p.data()})),y=m.docs.map(p=>({id:p.id,...p.data()})),_=(p,j)=>p.find($=>$.id&&$.id.toLowerCase().includes(j)||$.name&&$.name.toLowerCase().includes(j)),q=[_(y,"food"),_(y,"heritage"),_(y,"artifact")].filter(Boolean),le=y.filter(p=>!q.some(j=>j.id===p.id)),ee=q.concat(le);u(h),l(ee.length?ee:y),v(p=>{const j=sessionStorage.getItem("selectedCity");if(h.some(B=>B.name===j))return j;if(h.length>0){const B=h[0].name;return sessionStorage.setItem("selectedCity",B),B}return""})}catch(t){console.error("Failed to load cities/categories:",t)}finally{I(!1)}},[]);a.useEffect(()=>{J()},[J]),a.useEffect(()=>{n&&!C&&o.some(t=>t.name===n)&&sessionStorage.setItem("selectedCity",n)},[n,C,o]);const k=o.find(t=>t.name===n);return a.useEffect(()=>{if(!n||!o.length){A(!1);return}const t=o.find(q=>q.name===n);if(!t)return;const m=t.heroVideoUrl||t.heroImageUrl||t.hero||"",h=t.heroWebMUrl||"",y=t.heroPosterUrl||"",_=/\.mp4|\.webm|\.ogg$/i.test(m);P(m),b(h),z(y),w(_),A(!0)},[n,o]),a.useEffect(()=>{let t=window.scrollY;const m=()=>{const h=window.scrollY;R(h>t&&h>40),t=h};return window.addEventListener("scroll",m,{passive:!0}),()=>window.removeEventListener("scroll",m)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#0b0b0c] via-[#111214] to-[#0a0a0a] text-white pb-28",children:[e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs(d.section,{className:"relative w-full overflow-hidden rounded-b-3xl shadow-2xl",children:[!M&&e.jsx("div",{className:"w-full h-[280px] bg-gradient-to-r from-[#071022] to-[#08102a] animate-pulse"}),M&&(S?e.jsxs(d.video,{ref:D,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,poster:g,className:"w-full h-[280px] object-cover",initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[c&&e.jsx("source",{src:c,type:"video/webm"}),e.jsx("source",{src:x,type:"video/mp4"}),"Your browser does not support the video tag."]},x):e.jsx(d.img,{src:x,alt:(k==null?void 0:k.name)||"city",className:"w-full h-[280px] object-cover",initial:{opacity:0},animate:{opacity:1},transition:{duration:.8}},x)),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/30 to-transparent"}),e.jsxs("div",{className:"absolute bottom-8 left-6 text-white",children:[e.jsx(d.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-4xl font-extrabold mb-2 tracking-tight drop-shadow-xl",children:n||"Explore"},n),e.jsx("p",{className:"text-sm text-gray-200",children:(k==null?void 0:k.subtitle)||"Hidden gems & curated escapes"})]})]}),e.jsxs("header",{className:"px-5 pt-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-1 text-gray-300",children:["Welcome back, ",re," ðŸ‘‹"]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[e.jsx("p",{children:"Currently exploring"}),e.jsxs("button",{onClick:()=>E(!0),className:"flex items-center gap-1 font-medium bg-white/10 backdrop-blur-md hover:bg-white/20 px-3 py-1 rounded-full border border-white/10 transition",children:[e.jsx(fe,{size:14,className:"text-blue-400"}),e.jsx("span",{children:n||"Select City"})]})]})]}),e.jsxs("div",{className:"flex items-center bg-white/5 backdrop-blur-lg rounded-full px-4 py-3 mb-5 mt-4 mx-5 border border-white/8",children:[e.jsx(be,{size:18,className:"text-gray-300"}),e.jsx("input",{readOnly:!0,onClick:()=>s("/search"),placeholder:"Search destinations, eateries, heritage...",className:"bg-transparent w-full text-sm ml-3 placeholder-gray-400 focus:outline-none text-gray-100","aria-label":"Search"}),e.jsx("button",{onClick:()=>f(!0),className:"ml-2 p-2 rounded-full bg-blue-600 text-white hover:bg-blue-700","aria-label":"Open filters",children:e.jsx(je,{size:16})})]}),e.jsx("div",{className:"px-5",children:C?e.jsx("div",{className:"space-y-8",children:[1,2,3].map(t=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-5 bg-gray-800/40 rounded w-1/2 mb-3"}),e.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar py-2 px-[6px]",children:[1,2,3].map(m=>e.jsx(oe,{},m))})]},t))}):r.length===0?e.jsx("div",{className:"text-center text-gray-400 py-10",children:"No categories found."}):n?r.map((t,m)=>e.jsx(Re,{category:t,selectedCity:n,globalFilter:N,isPriorityRow:m===0,navigate:s,user:i,showToast:Z,showLoginPrompt:ne},`${n}-${t.id}`)):e.jsx("div",{className:"text-center text-gray-400 py-10",children:"Please select a city to see spots."})})]}),e.jsx(G,{children:V&&e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end justify-center z-50",children:e.jsxs(d.div,{initial:{y:300},animate:{y:0},exit:{y:300},transition:{duration:.28},onClick:t=>t.stopPropagation(),className:"bg-[#0b0b0c] w-full max-w-md rounded-t-3xl p-6 pb-24 shadow-xl border-t border-white/8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:"Choose Destination"}),e.jsx("button",{onClick:()=>E(!1),className:"text-gray-400 hover:text-white",children:e.jsx(se,{size:18})})]}),e.jsx("div",{className:"space-y-3",children:o.map(t=>e.jsxs("button",{onClick:()=>{v(t.name),E(!1),Z(`Now exploring ${t.name} âœˆï¸`)},className:`w-full px-4 py-3 rounded-xl flex items-center justify-between transition ${t.name===n?"bg-blue-600 text-white":"hover:bg-white/6 text-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.thumbnail||t.heroImageUrl||t.hero,alt:t.name,className:"w-12 h-8 object-cover rounded-md"}),e.jsxs("div",{className:"flex flex-col leading-tight text-left",children:[e.jsx("span",{className:"font-medium",children:t.name}),t.subtitle&&e.jsx("span",{className:"text-xs text-gray-300/70",children:t.subtitle})]})]}),e.jsx(ie,{size:18})]},t.id))})]})})}),e.jsx(G,{children:L&&e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-end",onClick:()=>f(!1),children:e.jsxs(d.div,{initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},transition:{type:"tween",ease:"easeOut",duration:.15},onClick:t=>t.stopPropagation(),className:"w-full max-w-md bg-[#0b0b0c] rounded-t-[28px] shadow-2xl p-6 pb-8 border-t border-white/6",children:[e.jsx("div",{className:"w-10 h-1.5 bg-gray-800 rounded-full mx-auto mb-4"}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100",children:"Filters"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-gray-200","aria-label":"Close filters",children:e.jsx(se,{size:18})})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:ve.map(t=>e.jsx(d.button,{whileTap:{scale:.97},onClick:()=>{H(t.id),requestAnimationFrame(()=>f(!1))},className:`px-4 py-2 rounded-full text-sm font-medium transition ${N===t.id?"bg-white/10 text-white":"bg-white/10 text-gray-200"}`,children:t.label},t.id))})]})})}),e.jsx(a.Suspense,{fallback:null,children:e.jsx(Le,{open:O,onClose:()=>U(!1)})}),e.jsx(G,{children:F&&e.jsx(d.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},exit:{opacity:0,y:40},transition:{duration:.28},className:"fixed bottom-28 left-1/2 -translate-x-1/2 bg-white/8 text-white text-sm px-4 py-2 rounded-full shadow-md backdrop-blur-md z-50",children:F})})]})}export{Fe as default};
